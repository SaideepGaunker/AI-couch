<!DOCTYPE html>
<html lang="en" ng-app="interviewPrepApp">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interview Prep AI Coach - Dashboard Fix</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/src/styles/common.css">
    <!-- Google Fonts - Poppins for modern look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        .btn {
            margin-right: 10px;
        }
    </style>
</head>

<body>
    <div class="container mt-4" ng-controller="DebugController as vm">
        <h2>AngularJS Debug Test</h2>

        <div class="card">
            <div class="card-body">
                <h5>Basic Data Binding Test</h5>
                <p>Test message: {{vm.testMessage}}</p>
                <p>Current time: {{vm.currentTime}}</p>
                <p>User name: {{vm.user.name || 'No user'}}</p>

                <h5 class="mt-4">Service Tests</h5>
                <ul>
                    <li>AuthService: {{vm.serviceTests.AuthService}}</li>
                    <li>ApiService: {{vm.serviceTests.ApiService}}</li>
                    <li>DifficultyDisplayService: {{vm.serviceTests.DifficultyDisplayService}}</li>
                    <li>SessionSettingsService: {{vm.serviceTests.SessionSettingsService}}</li>
                    <li>UnifiedDifficultyStateService: {{vm.serviceTests.UnifiedDifficultyStateService}}</li>
                </ul>

                <h5 class="mt-4">Dashboard Data Test</h5>
                <p>Stats loaded: {{vm.dashboardTest.statsLoaded}}</p>
                <p>Total sessions: {{vm.dashboardTest.stats.total_sessions || 0}}</p>
                <p>Error: {{vm.dashboardTest.error || 'None'}}</p>

                <button type="button" class="btn btn-primary" ng-click="vm.testDashboardData()">Test Dashboard
                    Data</button>
                <button type="button" class="btn btn-secondary" ng-click="vm.refreshTest()">Refresh Test</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular-route.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular-animate.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular-sanitize.min.js"></script>

    <!-- App Scripts -->
    <script src="./src/js/app.js"></script>

    <!-- Controller Scripts -->
    <script src="./src/js/controllers/main.controller.js"></script>
    <script src="./src/js/controllers/unified-practice.controller.js"></script>

    <!-- Component Scripts -->
    <script src="./src/components/home/home.component.js"></script>
    <script src="./src/components/home/home.controller.js"></script>
    <script src="./src/components/dashboard/dashboard.component.js"></script>
    <script src="./src/components/dashboard/dashboard.controller.js"></script>
    <script src="./src/components/auth/login/login.component.js"></script>
    <script src="./src/components/auth/login/login.controller.js"></script>
    <script src="./src/components/auth/register/register.component.js"></script>
    <script src="./src/components/auth/register/register.controller.js"></script>
    <script src="./src/components/interview/interview.component.js"></script>
    <script src="./src/components/interview/interview.controller.js"></script>
    <script src="./src/components/interview-setup/interview-setup.component.js"></script>
    <script src="./src/components/interview-setup/interview-setup.controller.js"></script>
    <script src="./src/components/interview-chat/interview-chat.component.js"></script>
    <script src="./src/components/interview-chat/interview-chat.controller.js"></script>
    <script src="./src/components/feedback/feedback.component.js"></script>
    <script src="./src/components/feedback/feedback.controller.js"></script>
    <script src="./src/components/test/test.component.js"></script>
    <script src="./src/components/test/test.controller.js"></script>
    <script src="./src/components/progress/progress.component.js"></script>
    <script src="./src/components/progress/progress.controller.js"></script>
    <script src="./src/components/profile/profile.component.js"></script>
    <script src="./src/components/profile/profile.controller.js"></script>

    <!-- Service Scripts -->
    <script src="./src/js/services/error-handling.service.js"></script>
    <script src="./src/js/services/api.service.js"></script>
    <script src="./src/js/services/auth.service.js"></script>
    <script src="./src/js/services/auth.interceptor.js"></script>
    <script src="./src/js/services/difficulty-display.service.js"></script>
    <script src="./src/js/services/session-settings.service.js"></script>
    <script src="./src/js/services/unified-difficulty-state.service.js"></script>
    <script src="./src/js/services/user.service.js"></script>
    <script src="./src/js/services/interview.service.js"></script>
    <script src="./src/js/services/session-data.service.js"></script>
    <script src="./src/js/services/posture.service.js"></script>
    <script src="./src/js/services/voice-analysis.service.js"></script>
    <script src="./src/js/services/posture-feedback-integration.service.js"></script>
    <script src="./src/js/services/role-hierarchy.service.js"></script>
    <script src="./src/js/services/form-error.service.js"></script>

    <!-- Additional Components -->
    <script src="./src/components/toast-notification/toast-notification.component.js"></script>
    <script src="./src/components/loading-indicator/loading-indicator.component.js"></script>
    <script src="./src/components/confirmation-dialog/confirmation-dialog.component.js"></script>
    <script src="./src/components/progress-indicator/progress-indicator.component.js"></script>
    <script src="./src/components/form-error-display/form-error-display.component.js"></script>
    <script src="./src/components/role-selector/role-selector.component.js"></script>
    <script src="./src/components/posture-feedback/posture-feedback.component.js"></script>
    <script src="./src/components/posture-feedback/posture-feedback.controller.js"></script>

    <script>
        angular.module('interviewPrepApp')
            .controller('DebugController', ['$timeout', '$injector', function ($timeout, $injector) {
                var vm = this;

                vm.testMessage = 'AngularJS is working!';
                vm.currentTime = new Date().toLocaleTimeString();
                vm.user = { name: 'Test User' };

                vm.serviceTests = {};
                vm.dashboardTest = {
                    statsLoaded: false,
                    stats: {},
                    error: null
                };

                // Test service availability
                var services = ['AuthService', 'ApiService', 'DifficultyDisplayService', 'SessionSettingsService', 'UnifiedDifficultyStateService'];

                services.forEach(function (serviceName) {
                    try {
                        var service = $injector.get(serviceName);
                        vm.serviceTests[serviceName] = service ? 'Available' : 'Not found';
                    } catch (error) {
                        vm.serviceTests[serviceName] = 'Error: ' + error.message;
                    }
                });

                vm.testDashboardData = function () {
                    try {
                        var ApiService = $injector.get('ApiService');

                        ApiService.get('/interviews/statistics')
                            .then(function (response) {
                                vm.dashboardTest.statsLoaded = true;
                                vm.dashboardTest.stats = response || {};
                                vm.dashboardTest.error = null;
                            })
                            .catch(function (error) {
                                vm.dashboardTest.error = error.message || 'API call failed';
                            });
                    } catch (error) {
                        vm.dashboardTest.error = 'Service injection failed: ' + error.message;
                    }
                };

                vm.refreshTest = function () {
                    vm.currentTime = new Date().toLocaleTimeString();
                };

                // Update time every second
                $timeout(function updateTime() {
                    vm.currentTime = new Date().toLocaleTimeString();
                    $timeout(updateTime, 1000);
                }, 1000);
            }]);
    </script>
</body>

</html>